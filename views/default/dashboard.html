<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{=URL('static', 'css/dashboard.css')}}">
    <title>Dashboard</title>
</head>

<body>
    <div class="dash-hero">
        <h1>{{=authAccount[0]['first_name']}}'s Dashboard</h1>
    </div>
    {{extend 'layout.html'}}
    <div class="contentWrapper">
        <div id="sidebar">
            <ul>
                <li id="activities-tab" onclick="tabSwitcher('activity-tab-wrapper')">My Activities</li>
                <li id="leads-tab" onclick="tabSwitcher('leads-tab-wrapper')">My Leads</li>
                <li id="orders-tab" onclick="tabSwitcher('orders-tab-wrapper')">My Sales</li>
                <li id="charts-tab" onclick="tabSwitcher('sales-chart-wrapper')">charts</li>
            </ul>
            <div id="closeSideBar">
                <h1> X </h1>
            </div>
        </div>

        <div id="tabs-container">

            <div id="activity-tab-wrapper" class="tab">
                <h1>My Upcoming Activities</h1>

                {{for idx, activity in enumerate(activities):}}
                <div class="act-card act-cards" data-index="{{=(idx)}}">
                    <!-- loop through the activity type table to find the correct activity type for this activity -->
                    {{for activityT in activityType:}}
                    {{if activityT.id == activity.activity_type_id:}}
                    <div class="info-card-section">
                        {{=P(activity.id, _class="activity-id")}}
                        {{=H1(activityT.description, _class='card-title')}}
                        {{=H3(activity.activity_date, _class='card-date')}}
                    </div>
                    {{=P(activity.notes, _class='card-notes')}}
                    {{pass}}
                    {{pass}}
                </div>
                {{pass}}
            </div>
            <div id="leads-tab-wrapper" class="tab">
                <h1>My Leads</h1>
                {{for idx, lead in enumerate(leads):}}
                <div class="act-card lead-cards" data-index="{{=(idx)}}">
                    <!-- loop through the activity type table to find the correct activity type for this activity -->
                    {{for type in leadType:}}
                    {{if type.id == lead.lead_source:}}
                    <div class="info-card-section">
                        {{=P(lead.id, _class="activity-id")}}
                        {{=H1(''.join([lead.first_name, ' ',lead.last_name]), _class='card-title')}}
                        {{=H3(type.description, _class='card-date')}}
                    </div>
                    {{=P(lead.lead_notes, _class='card-notes')}}
                    {{pass}}
                    {{pass}}
                </div>
                {{pass}}
            </div>
            <div id="orders-tab-wrapper" class="tab">
                <h1>My Sales</h1>
                {{for idx, order in enumerate(orders):}}
                <div class="act-card order-cards" data-index="{{=(idx)}}">
                    <!-- loop through the contacts table to find who this order is for -->
                    {{for contact in contacts:}}
                    {{if contact.id == order.customer:}}
                    <div class="info-card-section">
                        {{=P(order.id, _class="activity-id")}}
                        {{=H1(''.join([contact.first_name, ' ',contact.last_name]), _class='card-title')}}
                        {{=H3(order.order_date, _class='card-date')}}
                    </div>
                    {{pass}}
                    {{pass}}
                    {{=P(order.order_notes, _class='card-notes')}}
                </div>
                {{pass}}

            </div>
            <div id="sales-chart-wrapper" class="tab">
                <h1>Sales Charts</h1>
                <div id="sales-chart-container">
                    <canvas id="sales-chart"></canvas>
                </div>
            </div>
        </div>
        <div id="modal-background">
            <div id="modal">
                <div id="modal-close">
                    <h1>X</h1>
                </div>
                <div id="modal-content">
                    <div id="main-content">
                        <h1 id="main-title">Modal Content</h1>
                        <h2 id="date">date</h2>
                        <p id="notes">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisi
                            vel tincidunt porttitor, nisi nisl tincidunt nisi, eget porttitor nisl nisi vel nisl. Nulla
                            facilisi.
                            Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae;
                            Nulla facilisi. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere
                            cubilia Curae; Nulla facilisi. Vestibulum ante ipsum primis in faucibus orci luctus et
                            ultrices posuere cubilia Curae; Nulla facilisi. Vestibulum ante ipsum primis in faucibus
                            orci luctus et ultrices posuere cubilia Curae; Nulla facilisi. Vestibulum ante ipsum
                            primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla facilisi.
                            Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae;
                            Nulla facilisi. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere
                            cubilia Curae; Nulla facilisi. Vestibulum ante ipsum primis in faucibus orci luctus et
                            ultrices posuere cubilia Curae; Nulla facilisi. Vestibulum ante ipsum primis in faucibus
                            orci luctus et ultrices posuere cubilia Curae; Nulla facilisi. Vestibulum ante ipsum
                            primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla facilisi
                        </p>
                    </div>
                    <div id="personal-content">
                        <h1 id="name"> First name Last name</h1>
                        <h2 id="company">Company</h2>
                        <table class="personal-modal-table">
                            <tr>
                                <td>
                                    <h5>Phone number:</h5>
                                </td>
                                <td>
                                    <h5 id="phone-number">333-333-3333</h5>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Email:</h5>
                                </td>
                                <td>
                                    <h5 id="email">blah@blah.com</h5>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.6.2/dist/chart.min.js">
</script>
<script>

    // get the content from the controller

    //json upcoming activities
    let activities = {{=XML(jsonActivities)}};
    //json upcoming leads
    let leads = {{=XML(jsonLeads)}};
    //json lead type
    let leadType = {{=XML(jsonLeadType)}};
    //json orders
    let orders = {{=XML(jsonOrders)}};
    //json contacts
    let contacts = {{=XML(jsonContacts)}};


    //open and close side bar
    document.getElementById('closeSideBar').addEventListener('click', function () {
        sidebar = document.getElementById('sidebar');
        console.log(window.getComputedStyle(sidebar,));
        if (window.getComputedStyle(sidebar).getPropertyValue('left') == '0px') {
            console.log("clicked");
            sidebar.style.left = '-250px';
        } else {
            document.getElementById('sidebar').style.left = '0';
        }
    });


    //Tab functionality
    function tabSwitcher(tab) {
        var tabs = document.getElementsByClassName('tab');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].style.display = 'none';
        }
        document.getElementById(tab).style.display = 'block';
    }

    //Modal functionality
    let activitiesElements = document.getElementsByClassName('act-cards');
    for (let i = 0; i < activitiesElements.length; i++) {
        activitiesElements[i].addEventListener('click', function (e) {
            document.getElementById('modal-background').style.display = 'block';
            console.log(e.target.getAttribute('data-index'));
            modalContent(activities[e.target.getAttribute('data-index')]);
        });
    }
    //close modal button functionality
    document.getElementById('modal-close').addEventListener('click', function () {
        document.getElementById('modal-background').style.display = 'none';
    });

    //close modal background functionality
    document.getElementById('modal-background').addEventListener('click', function (e) {
        if (e.target.id == 'modal-background') {
            document.getElementById('modal-background').style.display = 'none';
        }
    });


    //modal content functionality
    function modalContent(info) {
        console.log(info);
    }
</script>



</html>